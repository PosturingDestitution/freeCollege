5/13/2024

EGP - exterior gateway protocols

Border Gateway Protocol (BGP) - which is an inter-domain routing protocol used for routing between different AS (autonomous systesms) on the internet
	EBGP(20) - is used between routers in different ASs, typically between routers belonging to different organizations or ISPs
	IBGP(200) - within a single AS to exchange routing information between routers...carries routing information learned from external peers (EBGP peers) throughout the AS, maintaining consistent and loop-free routing paths.
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
IGP - interior gateway protocols

OSPF - 110AD (classless, supports VLSM, CIDR, manual route summarization, equal cost load balancing!)
	metric - interface cost
		Gigabit Ethernet 1Gbps - 1
		Fast Ethernet 100Mbps - 1
		Ethernet 10Mbps - 10
		DS1 1.544Mbps - 64
		DSL 768 Kbps - 133
		
		ex. interface cost = reference bandwidth (100 Mbps) / interface bandwidth (Ethernet 10 Mbps) = 10
		Cisco routers have three methods to change the OSPF cost:
			1. in interface sub-mode use (ip ospf cost <1-65535>)
			2. changing the 'interface bandwidth' setting (Kbps), which changes the calculated value
			3. changing the reference bandwidth setting, which changes the calculated value ... (enter the ospf mode and use the #auto-cost reference-bandwidth command) NOTE change reference for all routers so calculation are based on the same information
	"OSPF is an open standard IGP used for exchanging routing table informaiton throughout a single AS in an IP network"
	"As a network engineer, you will likely encounter OSPF issues most of the time..."	

	OSPF hellos (10 sec)
	OSPF dead timer (40 sec ... 4x hellos)
	
	neighbor table - information about OSPF neighbors
	topology table - topological structure of a network
	routing table - best routes
	
	Router ID:
		a. first router-id command under the OSPF process
		b. otherwise highest IP address of the router's loopback interfaces (loopback interfaces - helps avoid relying on phycial hardware ... virtual network interface always up uses loopback address used for testing ... they provide a consistent point for software processes to communicate within the device ...often used as a src/dest for routing protocols, SSH, SNMP)
		c. otherwise highest IP address of the router's physical interfaces
		
	BECOMING NEIGHBORS
	*The following fields inside the Hellos need to be the same in order to become neighbors: subnet, area id, timers, authentication, area stub flag, MTU
	1. init - a router has received a Hello message from the other OSPF router
	2.  2-way - the neighbor has received the Hello message and replied with a Hello of its own
	3. Exstart state - beginning of the LSDB exchange between both routers
	4. exchange - Database Descriptor(DBD) packets are exchanged. DBDs contain LSAs headers. Routers will use this information to see what LSAs need to be exchanged
	5. loading - one neighbor sends LSRs for every network it does not know about. The other neighbor replies with the LSUs, which contain information about requested networks. After all the requested information have been received, other neighbor goes through the same process
	6. full - both routers have the synchronized database and are fully adjacent to eachother

	OSPF Routing Protocol Areas - logical grouping of contiguous networks and routers (decreases the size of both the topology and routing tables stored on each router, less time required to run SPF, routing update times improve)
		routers in the same area have the same topology table, but they do not know about routers in the other areas	
		*each OSPF network has to connect to the backbone area(area 0)
		an ABR is a router with interfaces in more than one area
		an ASBR is a router that connects an OSPF network to other routing domains

		LSA, LSU, and LSR:
			1. routers will send a list of LSAs in their respective topology databases
			2. each router checks its topology database and sends a LSR message requesting all LSAs not found in its own topology table
			3. the other router responds with LSU containing all LSA requested

	Cisco Bandwidth Command vs Clock Rate & Speed Commands:
		It's pretty common for individuals, especiallly new network prefessionals, to get the two interface commands speed and bandwidth mixed up.
		Most believe that when applied to an interface, the Cisco Bandwidth command and speed command have the same meaning and that the goal is to lower the interface's throughput to the limit given by bandwidth or speed.
		The two commands have completely different scopes, and they do not limit the actual speed in any way.

			Bandwidth Command (interface config mode) - used to communicate the bandwidth value of an interface to higher-level protocols (no bandwidth to restore default bandwidth settings)
				inherit - specifies how a subinterface inherits the bandwidth of its main interface
				receive - enables asymmetic transmit/receive operation so that the transmitted (inherit [kbps]) and received bandwidth are different

			Speed - You can set an interface that is 100Mbps to 10Mbps which will change OSPF/EIGRP cost calculation

			Clock Rate Command - On SERIAL links, this command is used to set the clock rate. While both ends of the serial link can set the clock rate, the router will only accept the command from the DCU end (usually an ISP modem)
				NOTE - The clock rate specifies how many bits can be tranmitted at a certain period. When the clock rate is set 64000, you will never be able to send more than 64 Kbps through the interface
			
	OSPF Configuration
		FIRST you must enable OSPF (router ospf PROCESS-ID) in global conf mode
		NEXT you need to define which interfaces OSPF will run and what networks will be advertised using (network IP_ADDRESS WILDCARD_MASK AREA_ID) command from the OSPF conf mode

	OSPF Passive Interface - on interfaces that do no have an OSPF router connected to them so that they won't advertise OSPF information
		1. r1(config)#router ospf 1
		2. r1(config-router)#passive-interface gi0/0/0
		passive-interface default (makes all interfaces passive)

	DR and BDR - based on the network type, OSPF will elect one DR and one BDR...these serve as the central point for exchanging OSPF routing information.
		each non-DR/BDR will only exchange their routing information only with the DR and BDR using 224.0.0.6 and the DR/BDR will respond with 224.0.0.5 multicast address	
		each non-DR/BDR router will only reach the 2-way state neighbor relationship with others ... while establishing a full state with the DR/BDR

		On LANs, DR and BDR have to be elected. Two rules are used to elect a DR and BDR
		1. router with the highest OSPF priority will become a DR(default is 1)
		2. router with the highest router ID becomes DR and next highest becomes BDR

	OSPF Default-Information Originate - default router/gateway of last resort used to not drop packets destined for unknown IPs 0.0.0.0/0 and ::/0
		R1#conf t
		R1(config)#router ospf 1
		R1(config-router)#default-information originate
	
	OSPF Load Balancing Configuration - can be done on a per packet basis or per destination (default) basis
		if you have a bunch of routes to a destination you can limit how many routes by using (maximum-paths 2) in ospf mode
		per-destination - packets for a given src and dest host pairs are guaranteed to take the same path, even if multiple OSPF paths are available (per-flow load balancing)
		per-packet load balancing - it uses the round-robin method to determine which path each packet takes to the dest IP. This is inappropriate for certain types of traffic, such as VoIP, which depends on the packets arriving at the dest in sequence

		R1#show ip cef (this command will show you which type of load balancing youre currently using)
		
		you can change how OSPF load balancing works in interface config mode: R1(config-if)ip load-sharing ?

	OSPF Summarization - OSPF unlike EIGRP does not support automatic summarization & OSPF can only summarize route on ABRs and ASBRs
		R1(config-router) area AREA_ID range IP_ADDRESS MASK

		**OSPF route filtering is a technique for identifying routes that can be advertised or received from neighbor routers. It can be used for traffic engineering, memory optimazation, and security enhancement. Each router in an area shares a copy of the OSPF database. As a result, routers are filtered as they enter the area via the ABR
			Filtering with Summarization - using not-advertise keyword when summarizing routes...this is only possible on ASBR or ABR...type 3 LSAs will be suppressed 
				in ospf config mode (area 1 range 192.168.1.0 255.255.255.0 not-advertise)
			Filtering with OSPF Areas - with the above method we cannot selectivly pick which areas can/cannot obtain that information this option is more granular
				1. we configure the prefix-list of the route that we're going to filter
					conf mode (ip prefix-list OSPF-FILTER seq 10 deny 192.168.2.0/24)
					conf mode (ip prefix-list OSPF-FILTER deq 20 permit 0.0.0.0/0 le 32)
				2. then, apply the same prefix-list to OSPF
					conf mode (router ospf 1)
					ospf mode (area 0 filter-list prefix OSPF-FILTER out)
			Local OSPF Filtering - in some cases, routes need to be removed only on specific routers in an area. OSPF is a link-state protocol that requires all routers in a given area to keep an identical copy of the LSDB. While a route may exist in the OSPF LSDB, it's possible not to install it in the local RIB by using a distribute-list
				conf mode 
					(ip access-list standard OSPF-FILTER)
				conf-std-nacl mode
					deny 192.168.3.0
					permit any
				ospf mode
					distribute-list OSPF-FILTER in				
	OSPF CONFIG VERIFY:
		if you have privledge mode : show run
		if you have user mode: show ip protocols / show ip ospf interface <brief>
	
	OSPF Troubleshooting (ospf show/debug commands)
		check neighbors state and role with (show ip ospf neighbor)
		check routers in the area with (show ip ospf database)
		check router IDs, reference bandwidth, number of interfaces, and authentication with (show ip ospf)

		(debug ip ospf packet) - shows hello packets that are being sent and received on the router
		(debug ip ospf) - shows the mismatch in hello parameters
		(debug ip ospf adj) - shows DR and BDR elections on a broadcast or non-broadcast multiaccess network
	
	OSPF network types - mainly p2p and broadcast some network types work together but youll need to make adjs. to timers:
	ex.
		broadcast to broadcast
		non-broadcast to non-broadcast
		p2p to p2p
		broadcast to non-broadcast (adjust timers)
		p2p to p2mp (adjust timers)
	
	Point-to-point - a connection between two specific points(OSPF routers) ... a packet on one router will only have one recipient ... no DR/BDR relationship ... ex leased lines using PPP or HDLC
	Broadcast - the default network type for an OSPF-enabled ethernet interface ... must have links that support L2 broadcasting ... requires DR/BDR

		configs:	
			in interface config mode use (ip ospf network ?)	
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	OSPF LSA TYPES USED FOR IPv4 ROUTING:
		1 router - generated and advertised by routers within a common area
			The type 1 LSAs are the LSDB's fundamental building blocks, and every OSPF router advertises them. There is a type 1 LSA record for every OSPF-enabled link.
			contents: LSA advertising router, LSA age, LSA sequence number, link count, link id
			
		2 network - it advertises multi-access network segments attached to the DR
			The DR always advertises the type 2 LSA and specifies all the routers connected to that network seg, which is what a type 2 LSA represents. A type 2 LSA is excluded from the LSDB if  a DR has not been elected since the correspongin type 1 LSA is a stub. The type 2 LSAs are not forwarded outside the OSPF area where they originated.

		3 summary - generated by the ABR, and advertises network prefixes originating from different areas
			This OSPF LSA type represent network from different areas. The ABRs' responsibility is to take part in various OSPF areas and make sure that networks associated with type 1 LSAs may be accessed in non-originating OSPF areas
			Again, ABRs do NOT forward type 1 and 2 LSAs into other areas. As a result, if an ABR receives a type 1 LSA, it will create a type 3 LSA that references the network in the original type 1 LSA. The type 2 LSA is then used to identify the network mask of the multi-access network. The ABR then advertises the type 3 LSA in other areas.
			an ABR regenerates a new type 3 LSA for the non-backbone area if it receives a type 3 LSA from the backbone or area 0. Then, it identifies itself as the advertising router with the additional costmetric

			contens:Link-state ID or network number, subnet mask, advertising ABR's IP address, network prefix metric			

		4 summary ASBR - generated by ABR...advertises a summary LSA for a specfic ASBR for other routers to find it

		5 AS external - generated by the ASBR...advertises LSAs for redistributed routes

		6 NSSA external - A not-so-stubby area does not allow type 5 LSAs, so type 7 LSAs are generated instead...advertising NSSA redistributed routes


		LSA Sequence Number - The Lin State Advertisement sequence number is a 32-bit number that solves issues brought on by network LSA propagation delays.
			The LSA sequence number is incremented whenever the originating router transmits LSAs.
			A router processes an LSA if the received LSA sequence number is greater than the LSA sequence in the link State Database(LSDB).
			However, the router discards the LSA if the LSA sequence is lower than the one found in the LSDB

		LSA Age - The OSPF LSA age is entered in the local LSDB and the age value increments by 1 every second. If a router's LSA age exceeds 1800 seconds or 30 minutes, the originating router advertises a new LSA with an age of 0
			The LSA is declared invalid and removed from the LSDB when its age hits 3600. The repeated flooding of LSAs is considered a secondary safety measure that makes sure all OSPF routers in an area keep a constant LSDB

	OSPF AUTHENTICATION - OSPF can be configured to authenticate every OSPF message. This is usually dont to prevent a rougue router from injecting false routing information and therefore causing a DOS attack | NOTE with OSPF authentication turned on, routers must pass the authentication process before becoming OSPF neighbors
			1. clear text authentication
			2. md5 authentication
		
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

RIP - one of the oldest distance-vextor routing protocols used in computer networking.
	each router in RIP network will have a routing tables that contains information about reachable networks and the next-hop routers to reach those networks
	periodically sends broadcasts (even if the topology has not been altered) to neighboring routers their routing table ... routing updates are sent using UDP on port 520
	metric - hop count.
	route selection - if two routes have the same hop count the route selection is arbitartily chosen...?
	RIPs max hop count is 15 anything more is considered unreachable

Distance vector - RIP(120), IGRP, EIGRP(90)
	*Unlike link-state routing protocols, distance vector protocols operate based on each router's knowledge of the distance (or "vector") to other network nodes and the direction in which packets should be forwarded
	1. Iterative update process - routers exchange their routing tables periodically with neighboring routers, sharing information about the distance and direction (next hop) to reach each destination network
	2. hop count is the metric
	3. limited network size
	4. lag in convergence time

Link state - OSPF, IS-IS(115)
	1. topology awareness (each router maintains an up-to date map of the networks nodes and edges)
	2. shortest path calculation (Dijkstra's)
	3. only sends updates when network needs to converge not periodically
	4. more scalable because entire routing tables are not being passed between routers

Distance vector protocols are susceptible to routing loops... so distance vector protocols imploy a few mechanisms
	split horizon - prevents router from advertising a route back onto the interface from which it was learned
	route poisoning -  when a router detects that one of its directly connected routes has failed, it sends the advertisments for that route withan INFINITE metric (16 for RIP because 15 is the maximum poisoning the route)...

	holddown timer - when a router receives the information about the unreachable route, the holddown timer is started... the router IGNORES all routing updates for that route until the timer expired...ONLY updates allowed during that period are updates sent from the router that originally advertised the route...IF that router advertise the update, the holddown timer is stopped and the routing information is processed.

		Router R1 has advertised its directly connected subnet 10.0.1.0/24 through RIP. After some period of time, the interface Fa0/1 on R1 fails and the router R1 sends the poisoned route to R2. R2 receives the routing update, marks the route as unreachable and starts the holddown timer. During that time all updates from any other routers about that route are ignored to prevent routing loops. If interface Fa0/1 on R1 comes back up, R1 again advertises the route. R2 process that update even if the holddown timer is still running, because the update is sent by the same router that originally advertised the route.

EIGRP(90) Metric Calculation and Formulas - [K1 * bandwidth + (K2 * bandwidth) / (256 - load) + K3 * delay] * [K5 / (reliability + K4)]
	
	EIGRP can support networks even if they are 255 hops away and has quick convergence features.		
	EIGRP metric values, by DEFAULT, utilize bandwidth(k1) value and delay(k3) value but also consider interface load(k2) and reliability(k4)...MTU (k5)
	What are K-values (K-maps)? represent the weighting factors used to calculate the composite metric for determining the best path to reach a dest. net. (0-255)
	
	By adjusting the K-values, network admins can control which parameters EIGRP prioritizes when selsecing the best path to a destination network. This felxibility allows for optimzation of routing decisions based on specific network reqs and conditions
	
